/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin: https://github.com/terrastruct/d2-obsidian
*/
var __create = Object.create;
var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __getProtoOf = Object.getPrototypeOf;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __commonJS = (cb, mod) => function __require() {
  return mod || (0, cb[__getOwnPropNames(cb)[0]])((mod = { exports: {} }).exports, mod), mod.exports;
};
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toESM = (mod, isNodeMode, target) => (target = mod != null ? __create(__getProtoOf(mod)) : {}, __copyProps(isNodeMode || !mod || !mod.__esModule ? __defProp(target, "default", { value: mod, enumerable: true }) : target, mod));
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// node_modules/lodash.debounce/index.js
var require_lodash = __commonJS({
  "node_modules/lodash.debounce/index.js"(exports, module2) {
    var FUNC_ERROR_TEXT = "Expected a function";
    var NAN = 0 / 0;
    var symbolTag = "[object Symbol]";
    var reTrim = /^\s+|\s+$/g;
    var reIsBadHex = /^[-+]0x[0-9a-f]+$/i;
    var reIsBinary = /^0b[01]+$/i;
    var reIsOctal = /^0o[0-7]+$/i;
    var freeParseInt = parseInt;
    var freeGlobal = typeof global == "object" && global && global.Object === Object && global;
    var freeSelf = typeof self == "object" && self && self.Object === Object && self;
    var root = freeGlobal || freeSelf || Function("return this")();
    var objectProto = Object.prototype;
    var objectToString = objectProto.toString;
    var nativeMax = Math.max;
    var nativeMin = Math.min;
    var now = function() {
      return root.Date.now();
    };
    function debounce2(func, wait, options) {
      var lastArgs, lastThis, maxWait, result, timerId, lastCallTime, lastInvokeTime = 0, leading = false, maxing = false, trailing = true;
      if (typeof func != "function") {
        throw new TypeError(FUNC_ERROR_TEXT);
      }
      wait = toNumber(wait) || 0;
      if (isObject(options)) {
        leading = !!options.leading;
        maxing = "maxWait" in options;
        maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;
        trailing = "trailing" in options ? !!options.trailing : trailing;
      }
      function invokeFunc(time) {
        var args = lastArgs, thisArg = lastThis;
        lastArgs = lastThis = void 0;
        lastInvokeTime = time;
        result = func.apply(thisArg, args);
        return result;
      }
      function leadingEdge(time) {
        lastInvokeTime = time;
        timerId = setTimeout(timerExpired, wait);
        return leading ? invokeFunc(time) : result;
      }
      function remainingWait(time) {
        var timeSinceLastCall = time - lastCallTime, timeSinceLastInvoke = time - lastInvokeTime, result2 = wait - timeSinceLastCall;
        return maxing ? nativeMin(result2, maxWait - timeSinceLastInvoke) : result2;
      }
      function shouldInvoke(time) {
        var timeSinceLastCall = time - lastCallTime, timeSinceLastInvoke = time - lastInvokeTime;
        return lastCallTime === void 0 || timeSinceLastCall >= wait || timeSinceLastCall < 0 || maxing && timeSinceLastInvoke >= maxWait;
      }
      function timerExpired() {
        var time = now();
        if (shouldInvoke(time)) {
          return trailingEdge(time);
        }
        timerId = setTimeout(timerExpired, remainingWait(time));
      }
      function trailingEdge(time) {
        timerId = void 0;
        if (trailing && lastArgs) {
          return invokeFunc(time);
        }
        lastArgs = lastThis = void 0;
        return result;
      }
      function cancel() {
        if (timerId !== void 0) {
          clearTimeout(timerId);
        }
        lastInvokeTime = 0;
        lastArgs = lastCallTime = lastThis = timerId = void 0;
      }
      function flush() {
        return timerId === void 0 ? result : trailingEdge(now());
      }
      function debounced() {
        var time = now(), isInvoking = shouldInvoke(time);
        lastArgs = arguments;
        lastThis = this;
        lastCallTime = time;
        if (isInvoking) {
          if (timerId === void 0) {
            return leadingEdge(lastCallTime);
          }
          if (maxing) {
            timerId = setTimeout(timerExpired, wait);
            return invokeFunc(lastCallTime);
          }
        }
        if (timerId === void 0) {
          timerId = setTimeout(timerExpired, wait);
        }
        return result;
      }
      debounced.cancel = cancel;
      debounced.flush = flush;
      return debounced;
    }
    function isObject(value) {
      var type = typeof value;
      return !!value && (type == "object" || type == "function");
    }
    function isObjectLike(value) {
      return !!value && typeof value == "object";
    }
    function isSymbol(value) {
      return typeof value == "symbol" || isObjectLike(value) && objectToString.call(value) == symbolTag;
    }
    function toNumber(value) {
      if (typeof value == "number") {
        return value;
      }
      if (isSymbol(value)) {
        return NAN;
      }
      if (isObject(value)) {
        var other = typeof value.valueOf == "function" ? value.valueOf() : value;
        value = isObject(other) ? other + "" : other;
      }
      if (typeof value != "string") {
        return value === 0 ? value : +value;
      }
      value = value.replace(reTrim, "");
      var isBinary = reIsBinary.test(value);
      return isBinary || reIsOctal.test(value) ? freeParseInt(value.slice(2), isBinary ? 2 : 8) : reIsBadHex.test(value) ? NAN : +value;
    }
    module2.exports = debounce2;
  }
});

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => D2Plugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian3 = require("obsidian");

// src/settings.ts
var import_obsidian = require("obsidian");

// src/constants.ts
var LAYOUT_ENGINES = {
  DAGRE: {
    value: "dagre",
    label: "dagre"
  },
  ELK: {
    value: "elk",
    label: "ELK"
  },
  TALA: {
    value: "tala",
    label: "TALA"
  }
};
var RecompileIcon = `
<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8.33325 83.3334V58.3334H33.3333" stroke="#2E3346" stroke-width="8.33333" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M91.6667 16.6666V41.6666H66.6667" stroke="#2E3346" stroke-width="8.33333" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M14.6249 37.5004C16.7381 31.5287 20.3296 26.1896 25.0644 21.9813C29.7991 17.773 35.5227 14.8328 41.7011 13.4348C47.8795 12.0369 54.3114 12.2268 60.3965 13.987C66.4817 15.7471 72.0218 19.02 76.4999 23.5004C80.978 27.9808 91.6666 41.667 91.6666 41.667M8.33325 58.3337C8.33325 58.3337 19.0218 72.02 23.4999 76.5004C27.978 80.9808 33.5181 84.2537 39.6033 86.0138C45.6884 87.774 52.1203 87.9639 58.2987 86.566C64.4771 85.168 70.2007 82.2277 74.9355 78.0195C79.6702 73.8112 83.2617 68.4721 85.3749 62.5004" stroke="#2E3346" stroke-width="8.33333" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
`;

// src/settings.ts
var DEFAULT_SETTINGS = {
  layoutEngine: "dagre",
  debounce: 500,
  theme: 0,
  apiToken: "",
  d2Path: "",
  pad: 100,
  sketch: false,
  containerHeight: 800
};
var D2SettingsTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  addTALASettings() {
    const talaSettings = this.containerEl.createEl("div");
    talaSettings.createEl("h3", {
      text: "TALA settings"
    });
    new import_obsidian.Setting(talaSettings).setName("API token").setDesc('To use TALA, copy your API token here or in ~/.local/state/tstruct/auth.json under the field "api_token"').addText((text) => text.setPlaceholder("tstruct_...").setValue(this.plugin.settings.apiToken).setDisabled(this.plugin.settings.layoutEngine !== LAYOUT_ENGINES.TALA.value).onChange(async (value) => {
      if (value && !value.startsWith("tstruct_")) {
        new import_obsidian.Notice("Invalid API token");
      } else {
        this.plugin.settings.apiToken = value;
        await this.plugin.saveSettings();
      }
    }));
    this.talaSettings = talaSettings;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h1", { text: "D2 plugin settings" });
    new import_obsidian.Setting(containerEl).setName("Layout engine").setDesc('Available layout engines include "dagre", "ELK", and "TALA" (TALA must be installed separately from D2)').addDropdown((dropdown) => {
      dropdown.addOption(LAYOUT_ENGINES.DAGRE.value, LAYOUT_ENGINES.DAGRE.label).addOption(LAYOUT_ENGINES.ELK.value, LAYOUT_ENGINES.ELK.label).addOption(LAYOUT_ENGINES.TALA.value, LAYOUT_ENGINES.TALA.label).setValue(this.plugin.settings.layoutEngine).onChange(async (value) => {
        var _a;
        this.plugin.settings.layoutEngine = value;
        await this.plugin.saveSettings();
        if (value === LAYOUT_ENGINES.TALA.value) {
          this.addTALASettings();
        } else {
          (_a = this.talaSettings) == null ? void 0 : _a.remove();
        }
      });
    });
    new import_obsidian.Setting(containerEl).setName("Theme ID").setDesc("Available themes are located at https://github.com/terrastruct/d2/tree/master/d2themes").addText((text) => text.setPlaceholder("Enter a theme ID").setValue(String(this.plugin.settings.theme)).onChange(async (value) => {
      if (!isNaN(Number(value)) || value === "") {
        this.plugin.settings.theme = Number(value || DEFAULT_SETTINGS.theme);
        await this.plugin.saveSettings();
      } else {
        new import_obsidian.Notice("Please specify a valid number");
      }
    }));
    new import_obsidian.Setting(containerEl).setName("Pad").setDesc("Pixels padded around the rendered diagram").addText((text) => text.setPlaceholder(String(DEFAULT_SETTINGS.pad)).setValue(String(this.plugin.settings.pad)).onChange(async (value) => {
      if (isNaN(Number(value))) {
        new import_obsidian.Notice("Please specify a valid number");
        this.plugin.settings.pad = Number(DEFAULT_SETTINGS.pad);
      } else if (value === "") {
        this.plugin.settings.pad = Number(DEFAULT_SETTINGS.pad);
      } else {
        this.plugin.settings.pad = Number(value);
      }
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Sketch mode").setDesc("Render the diagram to look like it was sketched by hand").addToggle((toggle) => toggle.setValue(this.plugin.settings.sketch).onChange(async (value) => {
      this.plugin.settings.sketch = value;
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Container height").setDesc("Diagram max render height in pixels (Requires d2 v0.2.2 and up)").addText((text) => text.setPlaceholder(String(DEFAULT_SETTINGS.containerHeight)).setValue(String(this.plugin.settings.containerHeight)).onChange(async (value) => {
      if (isNaN(Number(value))) {
        new import_obsidian.Notice("Please specify a valid number");
        this.plugin.settings.containerHeight = Number(DEFAULT_SETTINGS.containerHeight);
      } else if (value === "") {
        this.plugin.settings.containerHeight = Number(DEFAULT_SETTINGS.containerHeight);
      } else {
        this.plugin.settings.containerHeight = Number(value);
      }
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Debounce").setDesc("How often should the diagram refresh in milliseconds (min 100)").addText((text) => text.setPlaceholder(String(DEFAULT_SETTINGS.debounce)).setValue(String(this.plugin.settings.debounce)).onChange(async (value) => {
      if (isNaN(Number(value))) {
        new import_obsidian.Notice("Please specify a valid number");
        this.plugin.settings.debounce = Number(DEFAULT_SETTINGS.debounce);
      } else if (value === "") {
        this.plugin.settings.debounce = Number(DEFAULT_SETTINGS.debounce);
      } else if (Number(value) < 100) {
        new import_obsidian.Notice("The value must be greater than 100");
        this.plugin.settings.debounce = Number(DEFAULT_SETTINGS.debounce);
      } else {
        this.plugin.settings.debounce = Number(value);
      }
      await this.plugin.saveSettings();
    }));
    new import_obsidian.Setting(containerEl).setName("Path (optional)").setDesc("Customize the local path to the directory `d2` is installed in (ex. if d2 is located at `/usr/local/bin/d2`, then the path is `/usr/local/bin`). This is only necessary if `d2` is not found automatically by the plugin (but is installed).").addText((text) => {
      text.setPlaceholder("/usr/local/Cellar").setValue(this.plugin.settings.d2Path).onChange(async (value) => {
        this.plugin.settings.d2Path = value;
        await this.plugin.saveSettings();
      });
    });
    if (this.plugin.settings.layoutEngine === LAYOUT_ENGINES.TALA.value) {
      this.addTALASettings();
    }
  }
};

// src/processor.ts
var import_obsidian2 = require("obsidian");
var import_child_process = require("child_process");
var import_path = require("path");
var import_lodash = __toESM(require_lodash());
var import_os = __toESM(require("os"));
var D2Processor = class {
  constructor(plugin) {
    this.attemptExport = async (source, el, ctx) => {
      var _a;
      el.createEl("h6", {
        text: "Generating D2 diagram...",
        cls: "D2__Loading"
      });
      let debouncedFunc = this.debouncedMap.get(ctx.docId);
      if (!debouncedFunc) {
        debouncedFunc = (0, import_lodash.default)(this.export, this.plugin.settings.debounce, {
          leading: true
        });
        this.debouncedMap.set(ctx.docId, debouncedFunc);
      }
      (_a = this.abortControllerMap.get(ctx.docId)) == null ? void 0 : _a.abort();
      const newAbortController = new AbortController();
      this.abortControllerMap.set(ctx.docId, newAbortController);
      await debouncedFunc(source, el, ctx, newAbortController.signal);
    };
    this.formatLinks = (svgEl) => {
	  console.log("formatLinks");
      const links = svgEl.querySelectorAll("a");
      links.forEach((link) => {
		console.log(link);
		link.classList.add("internal-link");
		link.setAttribute("data-href", link.getAttribute("href"));
      });
    };
    this.sanitizeSVGIDs = (svgEl, docID) => {
      const overrides = svgEl.querySelectorAll("marker, mask, filter");
      const overrideIDs = [];
      overrides.forEach((override) => {
        const id = override.getAttribute("id");
        if (id) {
          overrideIDs.push(id);
        }
      });
      return overrideIDs.reduce((svgHTML, overrideID) => {
        return svgHTML.replaceAll(overrideID, [overrideID, docID].join("-"));
      }, svgEl.outerHTML);
    };
    this.export = async (source, el, ctx, signal) => {
      try {
        const image = await this.generatePreview(source, signal);
        if (image) {
          el.empty();
          this.prevImage = image;
          this.insertImage(image, el, ctx);
          const button = new import_obsidian2.ButtonComponent(el).setClass("Preview__Recompile").setIcon("recompile").onClick((e) => {
            e.preventDefault();
            e.stopPropagation();
            el.empty();
            this.attemptExport(source, el, ctx);
          });
          button.buttonEl.createEl("span", {
            text: "Recompile"
          });
        }
      } catch (err) {
        el.empty();
        const errorEl = el.createEl("pre", {
          cls: "markdown-rendered pre Preview__Error"
        });
        errorEl.createEl("code", {
          text: "D2 Compilation Error:",
          cls: "Preview__Error--Title"
        });
        errorEl.createEl("code", {
          text: err.message
        });
        if (this.prevImage) {
          this.insertImage(this.prevImage, el, ctx);
        }
      }
    };
    this.plugin = plugin;
    this.debouncedMap = /* @__PURE__ */ new Map();
    this.abortControllerMap = /* @__PURE__ */ new Map();
  }
  insertImage(image, el, ctx) {
    const parser = new DOMParser();
    const svg = parser.parseFromString(image, "image/svg+xml");
    const containerEl = el.createDiv();
    containerEl.style.maxHeight = `${this.plugin.settings.containerHeight}px`;
    containerEl.style.height = "100vh";
    containerEl.style.width = "100%";
    containerEl.style.position = "relative";
    const svgEl = svg.documentElement;
    svgEl.style.position = "absolute";
    svgEl.style.width = "100%";
    svgEl.style.height = "100%";
	this.formatLinks(svgEl);
    containerEl.innerHTML = this.sanitizeSVGIDs(svgEl, ctx.docId);
  }
  async generatePreview(source, signal) {
    var _a, _b;
    const pathArray = [process.env.PATH, "/opt/homebrew/bin", "/usr/local/bin"];
    if (import_os.default.platform() === "win32") {
      pathArray.push(`C:Program FilesD2`);
    } else {
      pathArray.push(`${process.env.HOME}/.local/bin`);
    }
    let GOPATH = "";
    try {
      GOPATH = (0, import_child_process.execSync)("go env GOPATH", {
        env: {
          ...process.env,
          PATH: pathArray.join(import_path.delimiter)
        }
      }).toString();
    } catch (error) {
    }
    if (GOPATH) {
      pathArray.push(`${GOPATH.replace("\n", "")}/bin`);
    }
    if (this.plugin.settings.d2Path) {
      pathArray.push(this.plugin.settings.d2Path);
    }
    const options = {
      ...process.env,
      env: {
        PATH: pathArray.join(import_path.delimiter)
      },
      signal
    };
    if (this.plugin.settings.apiToken) {
      options.env.TSTRUCT_TOKEN = this.plugin.settings.apiToken;
    }
    let args = [
      `d2`,
      "-",
      `--theme=${this.plugin.settings.theme}`,
      `--layout=${this.plugin.settings.layoutEngine}`,
      `--pad=${this.plugin.settings.pad}`,
      `--sketch=${this.plugin.settings.sketch}`,
      "--bundle=false"
    ];
    const cmd = args.join(" ");
    const child = (0, import_child_process.exec)(cmd, options);
    (_a = child.stdin) == null ? void 0 : _a.write(source);
    (_b = child.stdin) == null ? void 0 : _b.end();
    let stdout;
    let stderr;
    if (child.stdout) {
      child.stdout.on("data", (data) => {
        if (stdout === void 0) {
          stdout = data;
        } else {
          stdout += data;
        }
      });
    }
    if (child.stderr) {
      child.stderr.on("data", (data) => {
        if (stderr === void 0) {
          stderr = data;
        } else {
          stderr += data;
        }
      });
    }
    return new Promise((resolve, reject) => {
      child.on("error", reject);
      child.on("close", (code) => {
        if (code === 0) {
          resolve(stdout);
          return;
        } else if (stderr) {
          console.error(stderr);
          reject(new Error(stderr));
        } else if (stdout) {
          console.error(stdout);
          reject(new Error(stdout));
        }
      });
    });
  }
};

// src/main.ts
var D2Plugin = class extends import_obsidian3.Plugin {
  async onload() {
    (0, import_obsidian3.addIcon)("recompile", RecompileIcon);
    await this.loadSettings();
    this.addSettingTab(new D2SettingsTab(this.app, this));
    const processor = new D2Processor(this);
    this.registerMarkdownCodeBlockProcessor("d2", processor.attemptExport);
    this.processor = processor;
  }
  onunload() {
    const abortControllers = this.processor.abortControllerMap.values();
    Array.from(abortControllers).forEach((controller) => {
      controller.abort();
    });
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibm9kZV9tb2R1bGVzL2xvZGFzaC5kZWJvdW5jZS9pbmRleC5qcyIsICJzcmMvbWFpbi50cyIsICJzcmMvc2V0dGluZ3MudHMiLCAic3JjL2NvbnN0YW50cy50cyIsICJzcmMvcHJvY2Vzc29yLnRzIl0sCiAgInNvdXJjZXNDb250ZW50IjogWyIvKipcbiAqIGxvZGFzaCAoQ3VzdG9tIEJ1aWxkKSA8aHR0cHM6Ly9sb2Rhc2guY29tLz5cbiAqIEJ1aWxkOiBgbG9kYXNoIG1vZHVsYXJpemUgZXhwb3J0cz1cIm5wbVwiIC1vIC4vYFxuICogQ29weXJpZ2h0IGpRdWVyeSBGb3VuZGF0aW9uIGFuZCBvdGhlciBjb250cmlidXRvcnMgPGh0dHBzOi8vanF1ZXJ5Lm9yZy8+XG4gKiBSZWxlYXNlZCB1bmRlciBNSVQgbGljZW5zZSA8aHR0cHM6Ly9sb2Rhc2guY29tL2xpY2Vuc2U+XG4gKiBCYXNlZCBvbiBVbmRlcnNjb3JlLmpzIDEuOC4zIDxodHRwOi8vdW5kZXJzY29yZWpzLm9yZy9MSUNFTlNFPlxuICogQ29weXJpZ2h0IEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBhbmQgSW52ZXN0aWdhdGl2ZSBSZXBvcnRlcnMgJiBFZGl0b3JzXG4gKi9cblxuLyoqIFVzZWQgYXMgdGhlIGBUeXBlRXJyb3JgIG1lc3NhZ2UgZm9yIFwiRnVuY3Rpb25zXCIgbWV0aG9kcy4gKi9cbnZhciBGVU5DX0VSUk9SX1RFWFQgPSAnRXhwZWN0ZWQgYSBmdW5jdGlvbic7XG5cbi8qKiBVc2VkIGFzIHJlZmVyZW5jZXMgZm9yIHZhcmlvdXMgYE51bWJlcmAgY29uc3RhbnRzLiAqL1xudmFyIE5BTiA9IDAgLyAwO1xuXG4vKiogYE9iamVjdCN0b1N0cmluZ2AgcmVzdWx0IHJlZmVyZW5jZXMuICovXG52YXIgc3ltYm9sVGFnID0gJ1tvYmplY3QgU3ltYm9sXSc7XG5cbi8qKiBVc2VkIHRvIG1hdGNoIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHdoaXRlc3BhY2UuICovXG52YXIgcmVUcmltID0gL15cXHMrfFxccyskL2c7XG5cbi8qKiBVc2VkIHRvIGRldGVjdCBiYWQgc2lnbmVkIGhleGFkZWNpbWFsIHN0cmluZyB2YWx1ZXMuICovXG52YXIgcmVJc0JhZEhleCA9IC9eWy0rXTB4WzAtOWEtZl0rJC9pO1xuXG4vKiogVXNlZCB0byBkZXRlY3QgYmluYXJ5IHN0cmluZyB2YWx1ZXMuICovXG52YXIgcmVJc0JpbmFyeSA9IC9eMGJbMDFdKyQvaTtcblxuLyoqIFVzZWQgdG8gZGV0ZWN0IG9jdGFsIHN0cmluZyB2YWx1ZXMuICovXG52YXIgcmVJc09jdGFsID0gL14wb1swLTddKyQvaTtcblxuLyoqIEJ1aWx0LWluIG1ldGhvZCByZWZlcmVuY2VzIHdpdGhvdXQgYSBkZXBlbmRlbmN5IG9uIGByb290YC4gKi9cbnZhciBmcmVlUGFyc2VJbnQgPSBwYXJzZUludDtcblxuLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBnbG9iYWxgIGZyb20gTm9kZS5qcy4gKi9cbnZhciBmcmVlR2xvYmFsID0gdHlwZW9mIGdsb2JhbCA9PSAnb2JqZWN0JyAmJiBnbG9iYWwgJiYgZ2xvYmFsLk9iamVjdCA9PT0gT2JqZWN0ICYmIGdsb2JhbDtcblxuLyoqIERldGVjdCBmcmVlIHZhcmlhYmxlIGBzZWxmYC4gKi9cbnZhciBmcmVlU2VsZiA9IHR5cGVvZiBzZWxmID09ICdvYmplY3QnICYmIHNlbGYgJiYgc2VsZi5PYmplY3QgPT09IE9iamVjdCAmJiBzZWxmO1xuXG4vKiogVXNlZCBhcyBhIHJlZmVyZW5jZSB0byB0aGUgZ2xvYmFsIG9iamVjdC4gKi9cbnZhciByb290ID0gZnJlZUdsb2JhbCB8fCBmcmVlU2VsZiB8fCBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpO1xuXG4vKiogVXNlZCBmb3IgYnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMuICovXG52YXIgb2JqZWN0UHJvdG8gPSBPYmplY3QucHJvdG90eXBlO1xuXG4vKipcbiAqIFVzZWQgdG8gcmVzb2x2ZSB0aGVcbiAqIFtgdG9TdHJpbmdUYWdgXShodHRwOi8vZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi83LjAvI3NlYy1vYmplY3QucHJvdG90eXBlLnRvc3RyaW5nKVxuICogb2YgdmFsdWVzLlxuICovXG52YXIgb2JqZWN0VG9TdHJpbmcgPSBvYmplY3RQcm90by50b1N0cmluZztcblxuLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgZm9yIHRob3NlIHdpdGggdGhlIHNhbWUgbmFtZSBhcyBvdGhlciBgbG9kYXNoYCBtZXRob2RzLiAqL1xudmFyIG5hdGl2ZU1heCA9IE1hdGgubWF4LFxuICAgIG5hdGl2ZU1pbiA9IE1hdGgubWluO1xuXG4vKipcbiAqIEdldHMgdGhlIHRpbWVzdGFtcCBvZiB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0aGF0IGhhdmUgZWxhcHNlZCBzaW5jZVxuICogdGhlIFVuaXggZXBvY2ggKDEgSmFudWFyeSAxOTcwIDAwOjAwOjAwIFVUQykuXG4gKlxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIF9cbiAqIEBzaW5jZSAyLjQuMFxuICogQGNhdGVnb3J5IERhdGVcbiAqIEByZXR1cm5zIHtudW1iZXJ9IFJldHVybnMgdGhlIHRpbWVzdGFtcC5cbiAqIEBleGFtcGxlXG4gKlxuICogXy5kZWZlcihmdW5jdGlvbihzdGFtcCkge1xuICogICBjb25zb2xlLmxvZyhfLm5vdygpIC0gc3RhbXApO1xuICogfSwgXy5ub3coKSk7XG4gKiAvLyA9PiBMb2dzIHRoZSBudW1iZXIgb2YgbWlsbGlzZWNvbmRzIGl0IHRvb2sgZm9yIHRoZSBkZWZlcnJlZCBpbnZvY2F0aW9uLlxuICovXG52YXIgbm93ID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiByb290LkRhdGUubm93KCk7XG59O1xuXG4vKipcbiAqIENyZWF0ZXMgYSBkZWJvdW5jZWQgZnVuY3Rpb24gdGhhdCBkZWxheXMgaW52b2tpbmcgYGZ1bmNgIHVudGlsIGFmdGVyIGB3YWl0YFxuICogbWlsbGlzZWNvbmRzIGhhdmUgZWxhcHNlZCBzaW5jZSB0aGUgbGFzdCB0aW1lIHRoZSBkZWJvdW5jZWQgZnVuY3Rpb24gd2FzXG4gKiBpbnZva2VkLiBUaGUgZGVib3VuY2VkIGZ1bmN0aW9uIGNvbWVzIHdpdGggYSBgY2FuY2VsYCBtZXRob2QgdG8gY2FuY2VsXG4gKiBkZWxheWVkIGBmdW5jYCBpbnZvY2F0aW9ucyBhbmQgYSBgZmx1c2hgIG1ldGhvZCB0byBpbW1lZGlhdGVseSBpbnZva2UgdGhlbS5cbiAqIFByb3ZpZGUgYG9wdGlvbnNgIHRvIGluZGljYXRlIHdoZXRoZXIgYGZ1bmNgIHNob3VsZCBiZSBpbnZva2VkIG9uIHRoZVxuICogbGVhZGluZyBhbmQvb3IgdHJhaWxpbmcgZWRnZSBvZiB0aGUgYHdhaXRgIHRpbWVvdXQuIFRoZSBgZnVuY2AgaXMgaW52b2tlZFxuICogd2l0aCB0aGUgbGFzdCBhcmd1bWVudHMgcHJvdmlkZWQgdG8gdGhlIGRlYm91bmNlZCBmdW5jdGlvbi4gU3Vic2VxdWVudFxuICogY2FsbHMgdG8gdGhlIGRlYm91bmNlZCBmdW5jdGlvbiByZXR1cm4gdGhlIHJlc3VsdCBvZiB0aGUgbGFzdCBgZnVuY2BcbiAqIGludm9jYXRpb24uXG4gKlxuICogKipOb3RlOioqIElmIGBsZWFkaW5nYCBhbmQgYHRyYWlsaW5nYCBvcHRpb25zIGFyZSBgdHJ1ZWAsIGBmdW5jYCBpc1xuICogaW52b2tlZCBvbiB0aGUgdHJhaWxpbmcgZWRnZSBvZiB0aGUgdGltZW91dCBvbmx5IGlmIHRoZSBkZWJvdW5jZWQgZnVuY3Rpb25cbiAqIGlzIGludm9rZWQgbW9yZSB0aGFuIG9uY2UgZHVyaW5nIHRoZSBgd2FpdGAgdGltZW91dC5cbiAqXG4gKiBJZiBgd2FpdGAgaXMgYDBgIGFuZCBgbGVhZGluZ2AgaXMgYGZhbHNlYCwgYGZ1bmNgIGludm9jYXRpb24gaXMgZGVmZXJyZWRcbiAqIHVudGlsIHRvIHRoZSBuZXh0IHRpY2ssIHNpbWlsYXIgdG8gYHNldFRpbWVvdXRgIHdpdGggYSB0aW1lb3V0IG9mIGAwYC5cbiAqXG4gKiBTZWUgW0RhdmlkIENvcmJhY2hvJ3MgYXJ0aWNsZV0oaHR0cHM6Ly9jc3MtdHJpY2tzLmNvbS9kZWJvdW5jaW5nLXRocm90dGxpbmctZXhwbGFpbmVkLWV4YW1wbGVzLylcbiAqIGZvciBkZXRhaWxzIG92ZXIgdGhlIGRpZmZlcmVuY2VzIGJldHdlZW4gYF8uZGVib3VuY2VgIGFuZCBgXy50aHJvdHRsZWAuXG4gKlxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIF9cbiAqIEBzaW5jZSAwLjEuMFxuICogQGNhdGVnb3J5IEZ1bmN0aW9uXG4gKiBAcGFyYW0ge0Z1bmN0aW9ufSBmdW5jIFRoZSBmdW5jdGlvbiB0byBkZWJvdW5jZS5cbiAqIEBwYXJhbSB7bnVtYmVyfSBbd2FpdD0wXSBUaGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyB0byBkZWxheS5cbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9ucz17fV0gVGhlIG9wdGlvbnMgb2JqZWN0LlxuICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy5sZWFkaW5nPWZhbHNlXVxuICogIFNwZWNpZnkgaW52b2tpbmcgb24gdGhlIGxlYWRpbmcgZWRnZSBvZiB0aGUgdGltZW91dC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBbb3B0aW9ucy5tYXhXYWl0XVxuICogIFRoZSBtYXhpbXVtIHRpbWUgYGZ1bmNgIGlzIGFsbG93ZWQgdG8gYmUgZGVsYXllZCBiZWZvcmUgaXQncyBpbnZva2VkLlxuICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy50cmFpbGluZz10cnVlXVxuICogIFNwZWNpZnkgaW52b2tpbmcgb24gdGhlIHRyYWlsaW5nIGVkZ2Ugb2YgdGhlIHRpbWVvdXQuXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyBkZWJvdW5jZWQgZnVuY3Rpb24uXG4gKiBAZXhhbXBsZVxuICpcbiAqIC8vIEF2b2lkIGNvc3RseSBjYWxjdWxhdGlvbnMgd2hpbGUgdGhlIHdpbmRvdyBzaXplIGlzIGluIGZsdXguXG4gKiBqUXVlcnkod2luZG93KS5vbigncmVzaXplJywgXy5kZWJvdW5jZShjYWxjdWxhdGVMYXlvdXQsIDE1MCkpO1xuICpcbiAqIC8vIEludm9rZSBgc2VuZE1haWxgIHdoZW4gY2xpY2tlZCwgZGVib3VuY2luZyBzdWJzZXF1ZW50IGNhbGxzLlxuICogalF1ZXJ5KGVsZW1lbnQpLm9uKCdjbGljaycsIF8uZGVib3VuY2Uoc2VuZE1haWwsIDMwMCwge1xuICogICAnbGVhZGluZyc6IHRydWUsXG4gKiAgICd0cmFpbGluZyc6IGZhbHNlXG4gKiB9KSk7XG4gKlxuICogLy8gRW5zdXJlIGBiYXRjaExvZ2AgaXMgaW52b2tlZCBvbmNlIGFmdGVyIDEgc2Vjb25kIG9mIGRlYm91bmNlZCBjYWxscy5cbiAqIHZhciBkZWJvdW5jZWQgPSBfLmRlYm91bmNlKGJhdGNoTG9nLCAyNTAsIHsgJ21heFdhaXQnOiAxMDAwIH0pO1xuICogdmFyIHNvdXJjZSA9IG5ldyBFdmVudFNvdXJjZSgnL3N0cmVhbScpO1xuICogalF1ZXJ5KHNvdXJjZSkub24oJ21lc3NhZ2UnLCBkZWJvdW5jZWQpO1xuICpcbiAqIC8vIENhbmNlbCB0aGUgdHJhaWxpbmcgZGVib3VuY2VkIGludm9jYXRpb24uXG4gKiBqUXVlcnkod2luZG93KS5vbigncG9wc3RhdGUnLCBkZWJvdW5jZWQuY2FuY2VsKTtcbiAqL1xuZnVuY3Rpb24gZGVib3VuY2UoZnVuYywgd2FpdCwgb3B0aW9ucykge1xuICB2YXIgbGFzdEFyZ3MsXG4gICAgICBsYXN0VGhpcyxcbiAgICAgIG1heFdhaXQsXG4gICAgICByZXN1bHQsXG4gICAgICB0aW1lcklkLFxuICAgICAgbGFzdENhbGxUaW1lLFxuICAgICAgbGFzdEludm9rZVRpbWUgPSAwLFxuICAgICAgbGVhZGluZyA9IGZhbHNlLFxuICAgICAgbWF4aW5nID0gZmFsc2UsXG4gICAgICB0cmFpbGluZyA9IHRydWU7XG5cbiAgaWYgKHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKEZVTkNfRVJST1JfVEVYVCk7XG4gIH1cbiAgd2FpdCA9IHRvTnVtYmVyKHdhaXQpIHx8IDA7XG4gIGlmIChpc09iamVjdChvcHRpb25zKSkge1xuICAgIGxlYWRpbmcgPSAhIW9wdGlvbnMubGVhZGluZztcbiAgICBtYXhpbmcgPSAnbWF4V2FpdCcgaW4gb3B0aW9ucztcbiAgICBtYXhXYWl0ID0gbWF4aW5nID8gbmF0aXZlTWF4KHRvTnVtYmVyKG9wdGlvbnMubWF4V2FpdCkgfHwgMCwgd2FpdCkgOiBtYXhXYWl0O1xuICAgIHRyYWlsaW5nID0gJ3RyYWlsaW5nJyBpbiBvcHRpb25zID8gISFvcHRpb25zLnRyYWlsaW5nIDogdHJhaWxpbmc7XG4gIH1cblxuICBmdW5jdGlvbiBpbnZva2VGdW5jKHRpbWUpIHtcbiAgICB2YXIgYXJncyA9IGxhc3RBcmdzLFxuICAgICAgICB0aGlzQXJnID0gbGFzdFRoaXM7XG5cbiAgICBsYXN0QXJncyA9IGxhc3RUaGlzID0gdW5kZWZpbmVkO1xuICAgIGxhc3RJbnZva2VUaW1lID0gdGltZTtcbiAgICByZXN1bHQgPSBmdW5jLmFwcGx5KHRoaXNBcmcsIGFyZ3MpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBmdW5jdGlvbiBsZWFkaW5nRWRnZSh0aW1lKSB7XG4gICAgLy8gUmVzZXQgYW55IGBtYXhXYWl0YCB0aW1lci5cbiAgICBsYXN0SW52b2tlVGltZSA9IHRpbWU7XG4gICAgLy8gU3RhcnQgdGhlIHRpbWVyIGZvciB0aGUgdHJhaWxpbmcgZWRnZS5cbiAgICB0aW1lcklkID0gc2V0VGltZW91dCh0aW1lckV4cGlyZWQsIHdhaXQpO1xuICAgIC8vIEludm9rZSB0aGUgbGVhZGluZyBlZGdlLlxuICAgIHJldHVybiBsZWFkaW5nID8gaW52b2tlRnVuYyh0aW1lKSA6IHJlc3VsdDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbWFpbmluZ1dhaXQodGltZSkge1xuICAgIHZhciB0aW1lU2luY2VMYXN0Q2FsbCA9IHRpbWUgLSBsYXN0Q2FsbFRpbWUsXG4gICAgICAgIHRpbWVTaW5jZUxhc3RJbnZva2UgPSB0aW1lIC0gbGFzdEludm9rZVRpbWUsXG4gICAgICAgIHJlc3VsdCA9IHdhaXQgLSB0aW1lU2luY2VMYXN0Q2FsbDtcblxuICAgIHJldHVybiBtYXhpbmcgPyBuYXRpdmVNaW4ocmVzdWx0LCBtYXhXYWl0IC0gdGltZVNpbmNlTGFzdEludm9rZSkgOiByZXN1bHQ7XG4gIH1cblxuICBmdW5jdGlvbiBzaG91bGRJbnZva2UodGltZSkge1xuICAgIHZhciB0aW1lU2luY2VMYXN0Q2FsbCA9IHRpbWUgLSBsYXN0Q2FsbFRpbWUsXG4gICAgICAgIHRpbWVTaW5jZUxhc3RJbnZva2UgPSB0aW1lIC0gbGFzdEludm9rZVRpbWU7XG5cbiAgICAvLyBFaXRoZXIgdGhpcyBpcyB0aGUgZmlyc3QgY2FsbCwgYWN0aXZpdHkgaGFzIHN0b3BwZWQgYW5kIHdlJ3JlIGF0IHRoZVxuICAgIC8vIHRyYWlsaW5nIGVkZ2UsIHRoZSBzeXN0ZW0gdGltZSBoYXMgZ29uZSBiYWNrd2FyZHMgYW5kIHdlJ3JlIHRyZWF0aW5nXG4gICAgLy8gaXQgYXMgdGhlIHRyYWlsaW5nIGVkZ2UsIG9yIHdlJ3ZlIGhpdCB0aGUgYG1heFdhaXRgIGxpbWl0LlxuICAgIHJldHVybiAobGFzdENhbGxUaW1lID09PSB1bmRlZmluZWQgfHwgKHRpbWVTaW5jZUxhc3RDYWxsID49IHdhaXQpIHx8XG4gICAgICAodGltZVNpbmNlTGFzdENhbGwgPCAwKSB8fCAobWF4aW5nICYmIHRpbWVTaW5jZUxhc3RJbnZva2UgPj0gbWF4V2FpdCkpO1xuICB9XG5cbiAgZnVuY3Rpb24gdGltZXJFeHBpcmVkKCkge1xuICAgIHZhciB0aW1lID0gbm93KCk7XG4gICAgaWYgKHNob3VsZEludm9rZSh0aW1lKSkge1xuICAgICAgcmV0dXJuIHRyYWlsaW5nRWRnZSh0aW1lKTtcbiAgICB9XG4gICAgLy8gUmVzdGFydCB0aGUgdGltZXIuXG4gICAgdGltZXJJZCA9IHNldFRpbWVvdXQodGltZXJFeHBpcmVkLCByZW1haW5pbmdXYWl0KHRpbWUpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHRyYWlsaW5nRWRnZSh0aW1lKSB7XG4gICAgdGltZXJJZCA9IHVuZGVmaW5lZDtcblxuICAgIC8vIE9ubHkgaW52b2tlIGlmIHdlIGhhdmUgYGxhc3RBcmdzYCB3aGljaCBtZWFucyBgZnVuY2AgaGFzIGJlZW5cbiAgICAvLyBkZWJvdW5jZWQgYXQgbGVhc3Qgb25jZS5cbiAgICBpZiAodHJhaWxpbmcgJiYgbGFzdEFyZ3MpIHtcbiAgICAgIHJldHVybiBpbnZva2VGdW5jKHRpbWUpO1xuICAgIH1cbiAgICBsYXN0QXJncyA9IGxhc3RUaGlzID0gdW5kZWZpbmVkO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBmdW5jdGlvbiBjYW5jZWwoKSB7XG4gICAgaWYgKHRpbWVySWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVySWQpO1xuICAgIH1cbiAgICBsYXN0SW52b2tlVGltZSA9IDA7XG4gICAgbGFzdEFyZ3MgPSBsYXN0Q2FsbFRpbWUgPSBsYXN0VGhpcyA9IHRpbWVySWQgPSB1bmRlZmluZWQ7XG4gIH1cblxuICBmdW5jdGlvbiBmbHVzaCgpIHtcbiAgICByZXR1cm4gdGltZXJJZCA9PT0gdW5kZWZpbmVkID8gcmVzdWx0IDogdHJhaWxpbmdFZGdlKG5vdygpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRlYm91bmNlZCgpIHtcbiAgICB2YXIgdGltZSA9IG5vdygpLFxuICAgICAgICBpc0ludm9raW5nID0gc2hvdWxkSW52b2tlKHRpbWUpO1xuXG4gICAgbGFzdEFyZ3MgPSBhcmd1bWVudHM7XG4gICAgbGFzdFRoaXMgPSB0aGlzO1xuICAgIGxhc3RDYWxsVGltZSA9IHRpbWU7XG5cbiAgICBpZiAoaXNJbnZva2luZykge1xuICAgICAgaWYgKHRpbWVySWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gbGVhZGluZ0VkZ2UobGFzdENhbGxUaW1lKTtcbiAgICAgIH1cbiAgICAgIGlmIChtYXhpbmcpIHtcbiAgICAgICAgLy8gSGFuZGxlIGludm9jYXRpb25zIGluIGEgdGlnaHQgbG9vcC5cbiAgICAgICAgdGltZXJJZCA9IHNldFRpbWVvdXQodGltZXJFeHBpcmVkLCB3YWl0KTtcbiAgICAgICAgcmV0dXJuIGludm9rZUZ1bmMobGFzdENhbGxUaW1lKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHRpbWVySWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGltZXJJZCA9IHNldFRpbWVvdXQodGltZXJFeHBpcmVkLCB3YWl0KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuICBkZWJvdW5jZWQuY2FuY2VsID0gY2FuY2VsO1xuICBkZWJvdW5jZWQuZmx1c2ggPSBmbHVzaDtcbiAgcmV0dXJuIGRlYm91bmNlZDtcbn1cblxuLyoqXG4gKiBDaGVja3MgaWYgYHZhbHVlYCBpcyB0aGVcbiAqIFtsYW5ndWFnZSB0eXBlXShodHRwOi8vd3d3LmVjbWEtaW50ZXJuYXRpb25hbC5vcmcvZWNtYS0yNjIvNy4wLyNzZWMtZWNtYXNjcmlwdC1sYW5ndWFnZS10eXBlcylcbiAqIG9mIGBPYmplY3RgLiAoZS5nLiBhcnJheXMsIGZ1bmN0aW9ucywgb2JqZWN0cywgcmVnZXhlcywgYG5ldyBOdW1iZXIoMClgLCBhbmQgYG5ldyBTdHJpbmcoJycpYClcbiAqXG4gKiBAc3RhdGljXG4gKiBAbWVtYmVyT2YgX1xuICogQHNpbmNlIDAuMS4wXG4gKiBAY2F0ZWdvcnkgTGFuZ1xuICogQHBhcmFtIHsqfSB2YWx1ZSBUaGUgdmFsdWUgdG8gY2hlY2suXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyBgdHJ1ZWAgaWYgYHZhbHVlYCBpcyBhbiBvYmplY3QsIGVsc2UgYGZhbHNlYC5cbiAqIEBleGFtcGxlXG4gKlxuICogXy5pc09iamVjdCh7fSk7XG4gKiAvLyA9PiB0cnVlXG4gKlxuICogXy5pc09iamVjdChbMSwgMiwgM10pO1xuICogLy8gPT4gdHJ1ZVxuICpcbiAqIF8uaXNPYmplY3QoXy5ub29wKTtcbiAqIC8vID0+IHRydWVcbiAqXG4gKiBfLmlzT2JqZWN0KG51bGwpO1xuICogLy8gPT4gZmFsc2VcbiAqL1xuZnVuY3Rpb24gaXNPYmplY3QodmFsdWUpIHtcbiAgdmFyIHR5cGUgPSB0eXBlb2YgdmFsdWU7XG4gIHJldHVybiAhIXZhbHVlICYmICh0eXBlID09ICdvYmplY3QnIHx8IHR5cGUgPT0gJ2Z1bmN0aW9uJyk7XG59XG5cbi8qKlxuICogQ2hlY2tzIGlmIGB2YWx1ZWAgaXMgb2JqZWN0LWxpa2UuIEEgdmFsdWUgaXMgb2JqZWN0LWxpa2UgaWYgaXQncyBub3QgYG51bGxgXG4gKiBhbmQgaGFzIGEgYHR5cGVvZmAgcmVzdWx0IG9mIFwib2JqZWN0XCIuXG4gKlxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIF9cbiAqIEBzaW5jZSA0LjAuMFxuICogQGNhdGVnb3J5IExhbmdcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIGNoZWNrLlxuICogQHJldHVybnMge2Jvb2xlYW59IFJldHVybnMgYHRydWVgIGlmIGB2YWx1ZWAgaXMgb2JqZWN0LWxpa2UsIGVsc2UgYGZhbHNlYC5cbiAqIEBleGFtcGxlXG4gKlxuICogXy5pc09iamVjdExpa2Uoe30pO1xuICogLy8gPT4gdHJ1ZVxuICpcbiAqIF8uaXNPYmplY3RMaWtlKFsxLCAyLCAzXSk7XG4gKiAvLyA9PiB0cnVlXG4gKlxuICogXy5pc09iamVjdExpa2UoXy5ub29wKTtcbiAqIC8vID0+IGZhbHNlXG4gKlxuICogXy5pc09iamVjdExpa2UobnVsbCk7XG4gKiAvLyA9PiBmYWxzZVxuICovXG5mdW5jdGlvbiBpc09iamVjdExpa2UodmFsdWUpIHtcbiAgcmV0dXJuICEhdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09ICdvYmplY3QnO1xufVxuXG4vKipcbiAqIENoZWNrcyBpZiBgdmFsdWVgIGlzIGNsYXNzaWZpZWQgYXMgYSBgU3ltYm9sYCBwcmltaXRpdmUgb3Igb2JqZWN0LlxuICpcbiAqIEBzdGF0aWNcbiAqIEBtZW1iZXJPZiBfXG4gKiBAc2luY2UgNC4wLjBcbiAqIEBjYXRlZ29yeSBMYW5nXG4gKiBAcGFyYW0geyp9IHZhbHVlIFRoZSB2YWx1ZSB0byBjaGVjay5cbiAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zIGB0cnVlYCBpZiBgdmFsdWVgIGlzIGEgc3ltYm9sLCBlbHNlIGBmYWxzZWAuXG4gKiBAZXhhbXBsZVxuICpcbiAqIF8uaXNTeW1ib2woU3ltYm9sLml0ZXJhdG9yKTtcbiAqIC8vID0+IHRydWVcbiAqXG4gKiBfLmlzU3ltYm9sKCdhYmMnKTtcbiAqIC8vID0+IGZhbHNlXG4gKi9cbmZ1bmN0aW9uIGlzU3ltYm9sKHZhbHVlKSB7XG4gIHJldHVybiB0eXBlb2YgdmFsdWUgPT0gJ3N5bWJvbCcgfHxcbiAgICAoaXNPYmplY3RMaWtlKHZhbHVlKSAmJiBvYmplY3RUb1N0cmluZy5jYWxsKHZhbHVlKSA9PSBzeW1ib2xUYWcpO1xufVxuXG4vKipcbiAqIENvbnZlcnRzIGB2YWx1ZWAgdG8gYSBudW1iZXIuXG4gKlxuICogQHN0YXRpY1xuICogQG1lbWJlck9mIF9cbiAqIEBzaW5jZSA0LjAuMFxuICogQGNhdGVnb3J5IExhbmdcbiAqIEBwYXJhbSB7Kn0gdmFsdWUgVGhlIHZhbHVlIHRvIHByb2Nlc3MuXG4gKiBAcmV0dXJucyB7bnVtYmVyfSBSZXR1cm5zIHRoZSBudW1iZXIuXG4gKiBAZXhhbXBsZVxuICpcbiAqIF8udG9OdW1iZXIoMy4yKTtcbiAqIC8vID0+IDMuMlxuICpcbiAqIF8udG9OdW1iZXIoTnVtYmVyLk1JTl9WQUxVRSk7XG4gKiAvLyA9PiA1ZS0zMjRcbiAqXG4gKiBfLnRvTnVtYmVyKEluZmluaXR5KTtcbiAqIC8vID0+IEluZmluaXR5XG4gKlxuICogXy50b051bWJlcignMy4yJyk7XG4gKiAvLyA9PiAzLjJcbiAqL1xuZnVuY3Rpb24gdG9OdW1iZXIodmFsdWUpIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJykge1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfVxuICBpZiAoaXNTeW1ib2wodmFsdWUpKSB7XG4gICAgcmV0dXJuIE5BTjtcbiAgfVxuICBpZiAoaXNPYmplY3QodmFsdWUpKSB7XG4gICAgdmFyIG90aGVyID0gdHlwZW9mIHZhbHVlLnZhbHVlT2YgPT0gJ2Z1bmN0aW9uJyA/IHZhbHVlLnZhbHVlT2YoKSA6IHZhbHVlO1xuICAgIHZhbHVlID0gaXNPYmplY3Qob3RoZXIpID8gKG90aGVyICsgJycpIDogb3RoZXI7XG4gIH1cbiAgaWYgKHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykge1xuICAgIHJldHVybiB2YWx1ZSA9PT0gMCA/IHZhbHVlIDogK3ZhbHVlO1xuICB9XG4gIHZhbHVlID0gdmFsdWUucmVwbGFjZShyZVRyaW0sICcnKTtcbiAgdmFyIGlzQmluYXJ5ID0gcmVJc0JpbmFyeS50ZXN0KHZhbHVlKTtcbiAgcmV0dXJuIChpc0JpbmFyeSB8fCByZUlzT2N0YWwudGVzdCh2YWx1ZSkpXG4gICAgPyBmcmVlUGFyc2VJbnQodmFsdWUuc2xpY2UoMiksIGlzQmluYXJ5ID8gMiA6IDgpXG4gICAgOiAocmVJc0JhZEhleC50ZXN0KHZhbHVlKSA/IE5BTiA6ICt2YWx1ZSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gZGVib3VuY2U7XG4iLCAiaW1wb3J0IHsgUGx1Z2luLCBhZGRJY29uIH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5cbmltcG9ydCB7IEQyUGx1Z2luU2V0dGluZ3MsIEQyU2V0dGluZ3NUYWIsIERFRkFVTFRfU0VUVElOR1MgfSBmcm9tIFwiLi9zZXR0aW5nc1wiO1xuaW1wb3J0IHsgRDJQcm9jZXNzb3IgfSBmcm9tIFwiLi9wcm9jZXNzb3JcIjtcbmltcG9ydCB7IFJlY29tcGlsZUljb24gfSBmcm9tIFwiLi9jb25zdGFudHNcIjtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRDJQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xuICBzZXR0aW5nczogRDJQbHVnaW5TZXR0aW5ncztcbiAgcHJvY2Vzc29yOiBEMlByb2Nlc3NvcjtcblxuICBhc3luYyBvbmxvYWQoKSB7XG4gICAgYWRkSWNvbihcInJlY29tcGlsZVwiLCBSZWNvbXBpbGVJY29uKTtcbiAgICBhd2FpdCB0aGlzLmxvYWRTZXR0aW5ncygpO1xuICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgRDJTZXR0aW5nc1RhYih0aGlzLmFwcCwgdGhpcykpO1xuXG4gICAgY29uc3QgcHJvY2Vzc29yID0gbmV3IEQyUHJvY2Vzc29yKHRoaXMpO1xuICAgIHRoaXMucmVnaXN0ZXJNYXJrZG93bkNvZGVCbG9ja1Byb2Nlc3NvcihcImQyXCIsIHByb2Nlc3Nvci5hdHRlbXB0RXhwb3J0KTtcblxuICAgIHRoaXMucHJvY2Vzc29yID0gcHJvY2Vzc29yO1xuICB9XG5cbiAgb251bmxvYWQoKSB7XG4gICAgY29uc3QgYWJvcnRDb250cm9sbGVycyA9IHRoaXMucHJvY2Vzc29yLmFib3J0Q29udHJvbGxlck1hcC52YWx1ZXMoKTtcbiAgICBBcnJheS5mcm9tKGFib3J0Q29udHJvbGxlcnMpLmZvckVhY2goKGNvbnRyb2xsZXIpID0+IHtcbiAgICAgIGNvbnRyb2xsZXIuYWJvcnQoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcbiAgICB0aGlzLnNldHRpbmdzID0gT2JqZWN0LmFzc2lnbih7fSwgREVGQVVMVF9TRVRUSU5HUywgYXdhaXQgdGhpcy5sb2FkRGF0YSgpKTtcbiAgfVxuXG4gIGFzeW5jIHNhdmVTZXR0aW5ncygpIHtcbiAgICBhd2FpdCB0aGlzLnNhdmVEYXRhKHRoaXMuc2V0dGluZ3MpO1xuICB9XG59XG4iLCAiaW1wb3J0IHsgTm90aWNlLCBBcHAsIFBsdWdpblNldHRpbmdUYWIsIFNldHRpbmcgfSBmcm9tIFwib2JzaWRpYW5cIjtcblxuaW1wb3J0IEQyUGx1Z2luIGZyb20gXCIuL21haW5cIjtcbmltcG9ydCB7IExBWU9VVF9FTkdJTkVTIH0gZnJvbSBcIi4vY29uc3RhbnRzXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRDJQbHVnaW5TZXR0aW5ncyB7XG4gIGxheW91dEVuZ2luZTogc3RyaW5nO1xuICBhcGlUb2tlbjogc3RyaW5nO1xuICBkZWJvdW5jZTogbnVtYmVyO1xuICB0aGVtZTogbnVtYmVyO1xuICBkMlBhdGg6IHN0cmluZztcbiAgcGFkOiBudW1iZXI7XG4gIHNrZXRjaDogYm9vbGVhbjtcbiAgY29udGFpbmVySGVpZ2h0OiBudW1iZXI7XG59XG5cbmV4cG9ydCBjb25zdCBERUZBVUxUX1NFVFRJTkdTOiBEMlBsdWdpblNldHRpbmdzID0ge1xuICBsYXlvdXRFbmdpbmU6IFwiZGFncmVcIixcbiAgZGVib3VuY2U6IDUwMCxcbiAgdGhlbWU6IDAsXG4gIGFwaVRva2VuOiBcIlwiLFxuICBkMlBhdGg6IFwiXCIsXG4gIHBhZDogMTAwLFxuICBza2V0Y2g6IGZhbHNlLFxuICBjb250YWluZXJIZWlnaHQ6IDgwMCxcbn07XG5cbmV4cG9ydCBjbGFzcyBEMlNldHRpbmdzVGFiIGV4dGVuZHMgUGx1Z2luU2V0dGluZ1RhYiB7XG4gIHBsdWdpbjogRDJQbHVnaW47XG4gIHRhbGFTZXR0aW5nczogSFRNTERpdkVsZW1lbnQ7XG5cbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogRDJQbHVnaW4pIHtcbiAgICBzdXBlcihhcHAsIHBsdWdpbik7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gIH1cblxuICBhZGRUQUxBU2V0dGluZ3MoKSB7XG4gICAgY29uc3QgdGFsYVNldHRpbmdzID0gdGhpcy5jb250YWluZXJFbC5jcmVhdGVFbChcImRpdlwiKTtcbiAgICB0YWxhU2V0dGluZ3MuY3JlYXRlRWwoXCJoM1wiLCB7XG4gICAgICB0ZXh0OiBcIlRBTEEgc2V0dGluZ3NcIixcbiAgICB9KTtcbiAgICBuZXcgU2V0dGluZyh0YWxhU2V0dGluZ3MpXG4gICAgICAuc2V0TmFtZShcIkFQSSB0b2tlblwiKVxuICAgICAgLnNldERlc2MoXG4gICAgICAgICdUbyB1c2UgVEFMQSwgY29weSB5b3VyIEFQSSB0b2tlbiBoZXJlIG9yIGluIH4vLmxvY2FsL3N0YXRlL3RzdHJ1Y3QvYXV0aC5qc29uIHVuZGVyIHRoZSBmaWVsZCBcImFwaV90b2tlblwiJ1xuICAgICAgKVxuICAgICAgLmFkZFRleHQoKHRleHQpID0+XG4gICAgICAgIHRleHRcbiAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCJ0c3RydWN0Xy4uLlwiKVxuICAgICAgICAgIC5zZXRWYWx1ZSh0aGlzLnBsdWdpbi5zZXR0aW5ncy5hcGlUb2tlbilcbiAgICAgICAgICAuc2V0RGlzYWJsZWQodGhpcy5wbHVnaW4uc2V0dGluZ3MubGF5b3V0RW5naW5lICE9PSBMQVlPVVRfRU5HSU5FUy5UQUxBLnZhbHVlKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIGlmICh2YWx1ZSAmJiAhdmFsdWUuc3RhcnRzV2l0aChcInRzdHJ1Y3RfXCIpKSB7XG4gICAgICAgICAgICAgIG5ldyBOb3RpY2UoXCJJbnZhbGlkIEFQSSB0b2tlblwiKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmFwaVRva2VuID0gdmFsdWU7XG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgdGhpcy50YWxhU2V0dGluZ3MgPSB0YWxhU2V0dGluZ3M7XG4gIH1cblxuICBkaXNwbGF5KCk6IHZvaWQge1xuICAgIGNvbnN0IHsgY29udGFpbmVyRWwgfSA9IHRoaXM7XG4gICAgY29udGFpbmVyRWwuZW1wdHkoKTtcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbChcImgxXCIsIHsgdGV4dDogXCJEMiBwbHVnaW4gc2V0dGluZ3NcIiB9KTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJMYXlvdXQgZW5naW5lXCIpXG4gICAgICAuc2V0RGVzYyhcbiAgICAgICAgJ0F2YWlsYWJsZSBsYXlvdXQgZW5naW5lcyBpbmNsdWRlIFwiZGFncmVcIiwgXCJFTEtcIiwgYW5kIFwiVEFMQVwiIChUQUxBIG11c3QgYmUgaW5zdGFsbGVkIHNlcGFyYXRlbHkgZnJvbSBEMiknXG4gICAgICApXG4gICAgICAuYWRkRHJvcGRvd24oKGRyb3Bkb3duKSA9PiB7XG4gICAgICAgIGRyb3Bkb3duXG4gICAgICAgICAgLmFkZE9wdGlvbihMQVlPVVRfRU5HSU5FUy5EQUdSRS52YWx1ZSwgTEFZT1VUX0VOR0lORVMuREFHUkUubGFiZWwpXG4gICAgICAgICAgLmFkZE9wdGlvbihMQVlPVVRfRU5HSU5FUy5FTEsudmFsdWUsIExBWU9VVF9FTkdJTkVTLkVMSy5sYWJlbClcbiAgICAgICAgICAuYWRkT3B0aW9uKExBWU9VVF9FTkdJTkVTLlRBTEEudmFsdWUsIExBWU9VVF9FTkdJTkVTLlRBTEEubGFiZWwpXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLmxheW91dEVuZ2luZSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5sYXlvdXRFbmdpbmUgPSB2YWx1ZTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgICAgaWYgKHZhbHVlID09PSBMQVlPVVRfRU5HSU5FUy5UQUxBLnZhbHVlKSB7XG4gICAgICAgICAgICAgIHRoaXMuYWRkVEFMQVNldHRpbmdzKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLnRhbGFTZXR0aW5ncz8ucmVtb3ZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgIG5ldyBTZXR0aW5nKGNvbnRhaW5lckVsKVxuICAgICAgLnNldE5hbWUoXCJUaGVtZSBJRFwiKVxuICAgICAgLnNldERlc2MoXG4gICAgICAgIFwiQXZhaWxhYmxlIHRoZW1lcyBhcmUgbG9jYXRlZCBhdCBodHRwczovL2dpdGh1Yi5jb20vdGVycmFzdHJ1Y3QvZDIvdHJlZS9tYXN0ZXIvZDJ0aGVtZXNcIlxuICAgICAgKVxuICAgICAgLmFkZFRleHQoKHRleHQpID0+XG4gICAgICAgIHRleHRcbiAgICAgICAgICAuc2V0UGxhY2Vob2xkZXIoXCJFbnRlciBhIHRoZW1lIElEXCIpXG4gICAgICAgICAgLnNldFZhbHVlKFN0cmluZyh0aGlzLnBsdWdpbi5zZXR0aW5ncy50aGVtZSkpXG4gICAgICAgICAgLm9uQ2hhbmdlKGFzeW5jICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgaWYgKCFpc05hTihOdW1iZXIodmFsdWUpKSB8fCB2YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy50aGVtZSA9IE51bWJlcih2YWx1ZSB8fCBERUZBVUxUX1NFVFRJTkdTLnRoZW1lKTtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBuZXcgTm90aWNlKFwiUGxlYXNlIHNwZWNpZnkgYSB2YWxpZCBudW1iZXJcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiUGFkXCIpXG4gICAgICAuc2V0RGVzYyhcIlBpeGVscyBwYWRkZWQgYXJvdW5kIHRoZSByZW5kZXJlZCBkaWFncmFtXCIpXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT5cbiAgICAgICAgdGV4dFxuICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihTdHJpbmcoREVGQVVMVF9TRVRUSU5HUy5wYWQpKVxuICAgICAgICAgIC5zZXRWYWx1ZShTdHJpbmcodGhpcy5wbHVnaW4uc2V0dGluZ3MucGFkKSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXNOYU4oTnVtYmVyKHZhbHVlKSkpIHtcbiAgICAgICAgICAgICAgbmV3IE5vdGljZShcIlBsZWFzZSBzcGVjaWZ5IGEgdmFsaWQgbnVtYmVyXCIpO1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wYWQgPSBOdW1iZXIoREVGQVVMVF9TRVRUSU5HUy5wYWQpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5wYWQgPSBOdW1iZXIoREVGQVVMVF9TRVRUSU5HUy5wYWQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MucGFkID0gTnVtYmVyKHZhbHVlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IHRoaXMucGx1Z2luLnNhdmVTZXR0aW5ncygpO1xuICAgICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIlNrZXRjaCBtb2RlXCIpXG4gICAgICAuc2V0RGVzYyhcIlJlbmRlciB0aGUgZGlhZ3JhbSB0byBsb29rIGxpa2UgaXQgd2FzIHNrZXRjaGVkIGJ5IGhhbmRcIilcbiAgICAgIC5hZGRUb2dnbGUoKHRvZ2dsZSkgPT5cbiAgICAgICAgdG9nZ2xlLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLnNrZXRjaCkub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3Muc2tldGNoID0gdmFsdWU7XG4gICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXG4gICAgICAuc2V0TmFtZShcIkNvbnRhaW5lciBoZWlnaHRcIilcbiAgICAgIC5zZXREZXNjKFwiRGlhZ3JhbSBtYXggcmVuZGVyIGhlaWdodCBpbiBwaXhlbHMgKFJlcXVpcmVzIGQyIHYwLjIuMiBhbmQgdXApXCIpXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT5cbiAgICAgICAgdGV4dFxuICAgICAgICAgIC5zZXRQbGFjZWhvbGRlcihTdHJpbmcoREVGQVVMVF9TRVRUSU5HUy5jb250YWluZXJIZWlnaHQpKVxuICAgICAgICAgIC5zZXRWYWx1ZShTdHJpbmcodGhpcy5wbHVnaW4uc2V0dGluZ3MuY29udGFpbmVySGVpZ2h0KSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXNOYU4oTnVtYmVyKHZhbHVlKSkpIHtcbiAgICAgICAgICAgICAgbmV3IE5vdGljZShcIlBsZWFzZSBzcGVjaWZ5IGEgdmFsaWQgbnVtYmVyXCIpO1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jb250YWluZXJIZWlnaHQgPSBOdW1iZXIoXG4gICAgICAgICAgICAgICAgREVGQVVMVF9TRVRUSU5HUy5jb250YWluZXJIZWlnaHRcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuY29udGFpbmVySGVpZ2h0ID0gTnVtYmVyKFxuICAgICAgICAgICAgICAgIERFRkFVTFRfU0VUVElOR1MuY29udGFpbmVySGVpZ2h0XG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5jb250YWluZXJIZWlnaHQgPSBOdW1iZXIodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiRGVib3VuY2VcIilcbiAgICAgIC5zZXREZXNjKFwiSG93IG9mdGVuIHNob3VsZCB0aGUgZGlhZ3JhbSByZWZyZXNoIGluIG1pbGxpc2Vjb25kcyAobWluIDEwMClcIilcbiAgICAgIC5hZGRUZXh0KCh0ZXh0KSA9PlxuICAgICAgICB0ZXh0XG4gICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFN0cmluZyhERUZBVUxUX1NFVFRJTkdTLmRlYm91bmNlKSlcbiAgICAgICAgICAuc2V0VmFsdWUoU3RyaW5nKHRoaXMucGx1Z2luLnNldHRpbmdzLmRlYm91bmNlKSlcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXNOYU4oTnVtYmVyKHZhbHVlKSkpIHtcbiAgICAgICAgICAgICAgbmV3IE5vdGljZShcIlBsZWFzZSBzcGVjaWZ5IGEgdmFsaWQgbnVtYmVyXCIpO1xuICAgICAgICAgICAgICB0aGlzLnBsdWdpbi5zZXR0aW5ncy5kZWJvdW5jZSA9IE51bWJlcihERUZBVUxUX1NFVFRJTkdTLmRlYm91bmNlKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZGVib3VuY2UgPSBOdW1iZXIoREVGQVVMVF9TRVRUSU5HUy5kZWJvdW5jZSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKE51bWJlcih2YWx1ZSkgPCAxMDApIHtcbiAgICAgICAgICAgICAgbmV3IE5vdGljZShcIlRoZSB2YWx1ZSBtdXN0IGJlIGdyZWF0ZXIgdGhhbiAxMDBcIik7XG4gICAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmRlYm91bmNlID0gTnVtYmVyKERFRkFVTFRfU0VUVElOR1MuZGVib3VuY2UpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZGVib3VuY2UgPSBOdW1iZXIodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSlcbiAgICAgICk7XG5cbiAgICBuZXcgU2V0dGluZyhjb250YWluZXJFbClcbiAgICAgIC5zZXROYW1lKFwiUGF0aCAob3B0aW9uYWwpXCIpXG4gICAgICAuc2V0RGVzYyhcbiAgICAgICAgXCJDdXN0b21pemUgdGhlIGxvY2FsIHBhdGggdG8gdGhlIGRpcmVjdG9yeSBgZDJgIGlzIGluc3RhbGxlZCBpbiAoZXguIGlmIGQyIGlzIGxvY2F0ZWQgYXQgYC91c3IvbG9jYWwvYmluL2QyYCwgdGhlbiB0aGUgcGF0aCBpcyBgL3Vzci9sb2NhbC9iaW5gKS4gVGhpcyBpcyBvbmx5IG5lY2Vzc2FyeSBpZiBgZDJgIGlzIG5vdCBmb3VuZCBhdXRvbWF0aWNhbGx5IGJ5IHRoZSBwbHVnaW4gKGJ1dCBpcyBpbnN0YWxsZWQpLlwiXG4gICAgICApXG4gICAgICAuYWRkVGV4dCgodGV4dCkgPT4ge1xuICAgICAgICB0ZXh0XG4gICAgICAgICAgLnNldFBsYWNlaG9sZGVyKFwiL3Vzci9sb2NhbC9DZWxsYXJcIilcbiAgICAgICAgICAuc2V0VmFsdWUodGhpcy5wbHVnaW4uc2V0dGluZ3MuZDJQYXRoKVxuICAgICAgICAgIC5vbkNoYW5nZShhc3luYyAodmFsdWUpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLmQyUGF0aCA9IHZhbHVlO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XG4gICAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgIGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5sYXlvdXRFbmdpbmUgPT09IExBWU9VVF9FTkdJTkVTLlRBTEEudmFsdWUpIHtcbiAgICAgIHRoaXMuYWRkVEFMQVNldHRpbmdzKCk7XG4gICAgfVxuICB9XG59XG4iLCAiY29uc3QgTEFZT1VUX0VOR0lORVMgPSB7XG4gIERBR1JFOiB7XG4gICAgdmFsdWU6IFwiZGFncmVcIixcbiAgICBsYWJlbDogXCJkYWdyZVwiLFxuICB9LFxuICBFTEs6IHtcbiAgICB2YWx1ZTogXCJlbGtcIixcbiAgICBsYWJlbDogXCJFTEtcIixcbiAgfSxcbiAgVEFMQToge1xuICAgIHZhbHVlOiBcInRhbGFcIixcbiAgICBsYWJlbDogXCJUQUxBXCIsXG4gIH0sXG59O1xuXG5jb25zdCBSZWNvbXBpbGVJY29uID0gYFxuPHN2ZyB3aWR0aD1cIjEwMFwiIGhlaWdodD1cIjEwMFwiIHZpZXdCb3g9XCIwIDAgMTAwIDEwMFwiIGZpbGw9XCJub25lXCIgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiPlxuPHBhdGggZD1cIk04LjMzMzI1IDgzLjMzMzRWNTguMzMzNEgzMy4zMzMzXCIgc3Ryb2tlPVwiIzJFMzM0NlwiIHN0cm9rZS13aWR0aD1cIjguMzMzMzNcIiBzdHJva2UtbGluZWNhcD1cInJvdW5kXCIgc3Ryb2tlLWxpbmVqb2luPVwicm91bmRcIi8+XG48cGF0aCBkPVwiTTkxLjY2NjcgMTYuNjY2NlY0MS42NjY2SDY2LjY2NjdcIiBzdHJva2U9XCIjMkUzMzQ2XCIgc3Ryb2tlLXdpZHRoPVwiOC4zMzMzM1wiIHN0cm9rZS1saW5lY2FwPVwicm91bmRcIiBzdHJva2UtbGluZWpvaW49XCJyb3VuZFwiLz5cbjxwYXRoIGQ9XCJNMTQuNjI0OSAzNy41MDA0QzE2LjczODEgMzEuNTI4NyAyMC4zMjk2IDI2LjE4OTYgMjUuMDY0NCAyMS45ODEzQzI5Ljc5OTEgMTcuNzczIDM1LjUyMjcgMTQuODMyOCA0MS43MDExIDEzLjQzNDhDNDcuODc5NSAxMi4wMzY5IDU0LjMxMTQgMTIuMjI2OCA2MC4zOTY1IDEzLjk4N0M2Ni40ODE3IDE1Ljc0NzEgNzIuMDIxOCAxOS4wMiA3Ni40OTk5IDIzLjUwMDRDODAuOTc4IDI3Ljk4MDggOTEuNjY2NiA0MS42NjcgOTEuNjY2NiA0MS42NjdNOC4zMzMyNSA1OC4zMzM3QzguMzMzMjUgNTguMzMzNyAxOS4wMjE4IDcyLjAyIDIzLjQ5OTkgNzYuNTAwNEMyNy45NzggODAuOTgwOCAzMy41MTgxIDg0LjI1MzcgMzkuNjAzMyA4Ni4wMTM4QzQ1LjY4ODQgODcuNzc0IDUyLjEyMDMgODcuOTYzOSA1OC4yOTg3IDg2LjU2NkM2NC40NzcxIDg1LjE2OCA3MC4yMDA3IDgyLjIyNzcgNzQuOTM1NSA3OC4wMTk1Qzc5LjY3MDIgNzMuODExMiA4My4yNjE3IDY4LjQ3MjEgODUuMzc0OSA2Mi41MDA0XCIgc3Ryb2tlPVwiIzJFMzM0NlwiIHN0cm9rZS13aWR0aD1cIjguMzMzMzNcIiBzdHJva2UtbGluZWNhcD1cInJvdW5kXCIgc3Ryb2tlLWxpbmVqb2luPVwicm91bmRcIi8+XG48L3N2Zz5cbmA7XG5cbmV4cG9ydCB7IExBWU9VVF9FTkdJTkVTLCBSZWNvbXBpbGVJY29uIH07XG4iLCAiaW1wb3J0IHsgTWFya2Rvd25Qb3N0UHJvY2Vzc29yQ29udGV4dCwgQnV0dG9uQ29tcG9uZW50IH0gZnJvbSBcIm9ic2lkaWFuXCI7XG5pbXBvcnQgeyBleGVjLCBleGVjU3luYyB9IGZyb20gXCJjaGlsZF9wcm9jZXNzXCI7XG5pbXBvcnQgeyBkZWxpbWl0ZXIgfSBmcm9tIFwicGF0aFwiO1xuaW1wb3J0IGRlYm91bmNlIGZyb20gXCJsb2Rhc2guZGVib3VuY2VcIjtcbmltcG9ydCBvcyBmcm9tIFwib3NcIjtcblxuaW1wb3J0IEQyUGx1Z2luIGZyb20gXCIuL21haW5cIjtcblxuZXhwb3J0IGNsYXNzIEQyUHJvY2Vzc29yIHtcbiAgcGx1Z2luOiBEMlBsdWdpbjtcbiAgZGVib3VuY2VkTWFwOiBNYXA8XG4gICAgc3RyaW5nLFxuICAgIChcbiAgICAgIHNvdXJjZTogc3RyaW5nLFxuICAgICAgZWw6IEhUTUxFbGVtZW50LFxuICAgICAgY3R4OiBNYXJrZG93blBvc3RQcm9jZXNzb3JDb250ZXh0LFxuICAgICAgc2lnbmFsOiBBYm9ydFNpZ25hbFxuICAgICkgPT4gUHJvbWlzZTx2b2lkPlxuICA+O1xuICBhYm9ydENvbnRyb2xsZXJNYXA6IE1hcDxzdHJpbmcsIEFib3J0Q29udHJvbGxlcj47XG4gIHByZXZJbWFnZTogc3RyaW5nO1xuICBhYm9ydENvbnRyb2xsZXI6IEFib3J0Q29udHJvbGxlcjtcblxuICBjb25zdHJ1Y3RvcihwbHVnaW46IEQyUGx1Z2luKSB7XG4gICAgdGhpcy5wbHVnaW4gPSBwbHVnaW47XG4gICAgdGhpcy5kZWJvdW5jZWRNYXAgPSBuZXcgTWFwKCk7XG4gICAgdGhpcy5hYm9ydENvbnRyb2xsZXJNYXAgPSBuZXcgTWFwKCk7XG4gIH1cblxuICBhdHRlbXB0RXhwb3J0ID0gYXN5bmMgKFxuICAgIHNvdXJjZTogc3RyaW5nLFxuICAgIGVsOiBIVE1MRWxlbWVudCxcbiAgICBjdHg6IE1hcmtkb3duUG9zdFByb2Nlc3NvckNvbnRleHRcbiAgKSA9PiB7XG4gICAgZWwuY3JlYXRlRWwoXCJoNlwiLCB7XG4gICAgICB0ZXh0OiBcIkdlbmVyYXRpbmcgRDIgZGlhZ3JhbS4uLlwiLFxuICAgICAgY2xzOiBcIkQyX19Mb2FkaW5nXCIsXG4gICAgfSk7XG4gICAgbGV0IGRlYm91bmNlZEZ1bmMgPSB0aGlzLmRlYm91bmNlZE1hcC5nZXQoY3R4LmRvY0lkKTtcbiAgICBpZiAoIWRlYm91bmNlZEZ1bmMpIHtcbiAgICAgIGRlYm91bmNlZEZ1bmMgPSBkZWJvdW5jZSh0aGlzLmV4cG9ydCwgdGhpcy5wbHVnaW4uc2V0dGluZ3MuZGVib3VuY2UsIHtcbiAgICAgICAgbGVhZGluZzogdHJ1ZSxcbiAgICAgIH0pO1xuICAgICAgdGhpcy5kZWJvdW5jZWRNYXAuc2V0KGN0eC5kb2NJZCwgZGVib3VuY2VkRnVuYyk7XG4gICAgfVxuXG4gICAgdGhpcy5hYm9ydENvbnRyb2xsZXJNYXAuZ2V0KGN0eC5kb2NJZCk/LmFib3J0KCk7XG4gICAgY29uc3QgbmV3QWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xuICAgIHRoaXMuYWJvcnRDb250cm9sbGVyTWFwLnNldChjdHguZG9jSWQsIG5ld0Fib3J0Q29udHJvbGxlcik7XG5cbiAgICBhd2FpdCBkZWJvdW5jZWRGdW5jKHNvdXJjZSwgZWwsIGN0eCwgbmV3QWJvcnRDb250cm9sbGVyLnNpZ25hbCk7XG4gIH07XG5cbiAgc2FuaXRpemVTVkdJRHMgPSAoc3ZnRWw6IEhUTUxFbGVtZW50LCBkb2NJRDogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgICAvLyBhcHBlbmQgZG9jSWQgdG8gPG1hcmtlcj4gfHwgPG1hc2s+IHx8IDxmaWx0ZXI+IGlkJ3Mgc28gdGhhdCB0aGV5J3JlIHVuaXF1ZSBhY3Jvc3MgZGlmZmVyZW50IHBhbmVscyAmIGVkaXQvdmlldyBtb2RlXG4gICAgY29uc3Qgb3ZlcnJpZGVzID0gc3ZnRWwucXVlcnlTZWxlY3RvckFsbChcIm1hcmtlciwgbWFzaywgZmlsdGVyXCIpO1xuICAgIGNvbnN0IG92ZXJyaWRlSURzOiBzdHJpbmdbXSA9IFtdO1xuICAgIG92ZXJyaWRlcy5mb3JFYWNoKChvdmVycmlkZSkgPT4ge1xuICAgICAgY29uc3QgaWQgPSBvdmVycmlkZS5nZXRBdHRyaWJ1dGUoXCJpZFwiKTtcbiAgICAgIGlmIChpZCkge1xuICAgICAgICBvdmVycmlkZUlEcy5wdXNoKGlkKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gb3ZlcnJpZGVJRHMucmVkdWNlKChzdmdIVE1MLCBvdmVycmlkZUlEKSA9PiB7XG4gICAgICByZXR1cm4gc3ZnSFRNTC5yZXBsYWNlQWxsKG92ZXJyaWRlSUQsIFtvdmVycmlkZUlELCBkb2NJRF0uam9pbihcIi1cIikpO1xuICAgIH0sIHN2Z0VsLm91dGVySFRNTCk7XG4gIH07XG5cbiAgaW5zZXJ0SW1hZ2UoaW1hZ2U6IHN0cmluZywgZWw6IEhUTUxFbGVtZW50LCBjdHg6IE1hcmtkb3duUG9zdFByb2Nlc3NvckNvbnRleHQpIHtcbiAgICBjb25zdCBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7XG4gICAgY29uc3Qgc3ZnID0gcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhpbWFnZSwgXCJpbWFnZS9zdmcreG1sXCIpO1xuICAgIGNvbnN0IGNvbnRhaW5lckVsID0gZWwuY3JlYXRlRGl2KCk7XG5cbiAgICBjb250YWluZXJFbC5zdHlsZS5tYXhIZWlnaHQgPSBgJHt0aGlzLnBsdWdpbi5zZXR0aW5ncy5jb250YWluZXJIZWlnaHR9cHhgO1xuICAgIGNvbnRhaW5lckVsLnN0eWxlLmhlaWdodCA9IFwiMTAwdmhcIjtcbiAgICBjb250YWluZXJFbC5zdHlsZS53aWR0aCA9IFwiMTAwJVwiO1xuICAgIGNvbnRhaW5lckVsLnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiO1xuXG4gICAgY29uc3Qgc3ZnRWwgPSBzdmcuZG9jdW1lbnRFbGVtZW50O1xuICAgIHN2Z0VsLnN0eWxlLnBvc2l0aW9uID0gXCJhYnNvbHV0ZVwiO1xuICAgIHN2Z0VsLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XG4gICAgc3ZnRWwuc3R5bGUuaGVpZ2h0ID0gXCIxMDAlXCI7XG5cbiAgICBjb250YWluZXJFbC5pbm5lckhUTUwgPSB0aGlzLnNhbml0aXplU1ZHSURzKHN2Z0VsLCBjdHguZG9jSWQpO1xuICB9XG5cbiAgZXhwb3J0ID0gYXN5bmMgKFxuICAgIHNvdXJjZTogc3RyaW5nLFxuICAgIGVsOiBIVE1MRWxlbWVudCxcbiAgICBjdHg6IE1hcmtkb3duUG9zdFByb2Nlc3NvckNvbnRleHQsXG4gICAgc2lnbmFsOiBBYm9ydFNpZ25hbFxuICApID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaW1hZ2UgPSBhd2FpdCB0aGlzLmdlbmVyYXRlUHJldmlldyhzb3VyY2UsIHNpZ25hbCk7XG4gICAgICBpZiAoaW1hZ2UpIHtcbiAgICAgICAgZWwuZW1wdHkoKTtcbiAgICAgICAgdGhpcy5wcmV2SW1hZ2UgPSBpbWFnZTtcbiAgICAgICAgdGhpcy5pbnNlcnRJbWFnZShpbWFnZSwgZWwsIGN0eCk7XG5cbiAgICAgICAgY29uc3QgYnV0dG9uID0gbmV3IEJ1dHRvbkNvbXBvbmVudChlbClcbiAgICAgICAgICAuc2V0Q2xhc3MoXCJQcmV2aWV3X19SZWNvbXBpbGVcIilcbiAgICAgICAgICAuc2V0SWNvbihcInJlY29tcGlsZVwiKVxuICAgICAgICAgIC5vbkNsaWNrKChlKSA9PiB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAgICAgZWwuZW1wdHkoKTtcbiAgICAgICAgICAgIHRoaXMuYXR0ZW1wdEV4cG9ydChzb3VyY2UsIGVsLCBjdHgpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgIGJ1dHRvbi5idXR0b25FbC5jcmVhdGVFbChcInNwYW5cIiwge1xuICAgICAgICAgIHRleHQ6IFwiUmVjb21waWxlXCIsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgZWwuZW1wdHkoKTtcbiAgICAgIGNvbnN0IGVycm9yRWwgPSBlbC5jcmVhdGVFbChcInByZVwiLCB7XG4gICAgICAgIGNsczogXCJtYXJrZG93bi1yZW5kZXJlZCBwcmUgUHJldmlld19fRXJyb3JcIixcbiAgICAgIH0pO1xuICAgICAgZXJyb3JFbC5jcmVhdGVFbChcImNvZGVcIiwge1xuICAgICAgICB0ZXh0OiBcIkQyIENvbXBpbGF0aW9uIEVycm9yOlwiLFxuICAgICAgICBjbHM6IFwiUHJldmlld19fRXJyb3ItLVRpdGxlXCIsXG4gICAgICB9KTtcbiAgICAgIGVycm9yRWwuY3JlYXRlRWwoXCJjb2RlXCIsIHtcbiAgICAgICAgdGV4dDogZXJyLm1lc3NhZ2UsXG4gICAgICB9KTtcbiAgICAgIGlmICh0aGlzLnByZXZJbWFnZSkge1xuICAgICAgICB0aGlzLmluc2VydEltYWdlKHRoaXMucHJldkltYWdlLCBlbCwgY3R4KTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgYXN5bmMgZ2VuZXJhdGVQcmV2aWV3KHNvdXJjZTogc3RyaW5nLCBzaWduYWw6IEFib3J0U2lnbmFsKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBwYXRoQXJyYXkgPSBbcHJvY2Vzcy5lbnYuUEFUSCwgXCIvb3B0L2hvbWVicmV3L2JpblwiLCBcIi91c3IvbG9jYWwvYmluXCJdO1xuXG4gICAgLy8gcGxhdGZvcm0gd2lsbCBiZSB3aW4zMiBldmVuIG9uIDY0IGJpdCB3aW5kb3dzXG4gICAgaWYgKG9zLnBsYXRmb3JtKCkgPT09IFwid2luMzJcIikge1xuICAgICAgcGF0aEFycmF5LnB1c2goYEM6XFxQcm9ncmFtIEZpbGVzXFxEMmApO1xuICAgIH0gZWxzZSB7XG4gICAgICBwYXRoQXJyYXkucHVzaChgJHtwcm9jZXNzLmVudi5IT01FfS8ubG9jYWwvYmluYCk7XG4gICAgfVxuXG4gICAgbGV0IEdPUEFUSCA9IFwiXCI7XG4gICAgdHJ5IHtcbiAgICAgIEdPUEFUSCA9IGV4ZWNTeW5jKFwiZ28gZW52IEdPUEFUSFwiLCB7XG4gICAgICAgIGVudjoge1xuICAgICAgICAgIC4uLnByb2Nlc3MuZW52LFxuICAgICAgICAgIFBBVEg6IHBhdGhBcnJheS5qb2luKGRlbGltaXRlciksXG4gICAgICAgIH0sXG4gICAgICB9KS50b1N0cmluZygpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBpZ25vcmUgaWYgZ28gaXMgbm90IGluc3RhbGxlZFxuICAgIH1cblxuICAgIGlmIChHT1BBVEgpIHtcbiAgICAgIHBhdGhBcnJheS5wdXNoKGAke0dPUEFUSC5yZXBsYWNlKFwiXFxuXCIsIFwiXCIpfS9iaW5gKTtcbiAgICB9XG4gICAgaWYgKHRoaXMucGx1Z2luLnNldHRpbmdzLmQyUGF0aCkge1xuICAgICAgcGF0aEFycmF5LnB1c2godGhpcy5wbHVnaW4uc2V0dGluZ3MuZDJQYXRoKTtcbiAgICB9XG5cbiAgICBjb25zdCBvcHRpb25zOiBhbnkgPSB7XG4gICAgICAuLi5wcm9jZXNzLmVudixcbiAgICAgIGVudjoge1xuICAgICAgICBQQVRIOiBwYXRoQXJyYXkuam9pbihkZWxpbWl0ZXIpLFxuICAgICAgfSxcbiAgICAgIHNpZ25hbCxcbiAgICB9O1xuICAgIGlmICh0aGlzLnBsdWdpbi5zZXR0aW5ncy5hcGlUb2tlbikge1xuICAgICAgb3B0aW9ucy5lbnYuVFNUUlVDVF9UT0tFTiA9IHRoaXMucGx1Z2luLnNldHRpbmdzLmFwaVRva2VuO1xuICAgIH1cblxuICAgIGxldCBhcmdzID0gW1xuICAgICAgYGQyYCxcbiAgICAgIFwiLVwiLFxuICAgICAgYC0tdGhlbWU9JHt0aGlzLnBsdWdpbi5zZXR0aW5ncy50aGVtZX1gLFxuICAgICAgYC0tbGF5b3V0PSR7dGhpcy5wbHVnaW4uc2V0dGluZ3MubGF5b3V0RW5naW5lfWAsXG4gICAgICBgLS1wYWQ9JHt0aGlzLnBsdWdpbi5zZXR0aW5ncy5wYWR9YCxcbiAgICAgIGAtLXNrZXRjaD0ke3RoaXMucGx1Z2luLnNldHRpbmdzLnNrZXRjaH1gLFxuICAgICAgXCItLWJ1bmRsZT1mYWxzZVwiLFxuICAgIF07XG4gICAgY29uc3QgY21kID0gYXJncy5qb2luKFwiIFwiKTtcbiAgICBjb25zdCBjaGlsZCA9IGV4ZWMoY21kLCBvcHRpb25zKTtcbiAgICBjaGlsZC5zdGRpbj8ud3JpdGUoc291cmNlKTtcbiAgICBjaGlsZC5zdGRpbj8uZW5kKCk7XG5cbiAgICBsZXQgc3Rkb3V0OiBhbnk7XG4gICAgbGV0IHN0ZGVycjogYW55O1xuXG4gICAgaWYgKGNoaWxkLnN0ZG91dCkge1xuICAgICAgY2hpbGQuc3Rkb3V0Lm9uKFwiZGF0YVwiLCAoZGF0YSkgPT4ge1xuICAgICAgICBpZiAoc3Rkb3V0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBzdGRvdXQgPSBkYXRhO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN0ZG91dCArPSBkYXRhO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoY2hpbGQuc3RkZXJyKSB7XG4gICAgICBjaGlsZC5zdGRlcnIub24oXCJkYXRhXCIsIChkYXRhKSA9PiB7XG4gICAgICAgIGlmIChzdGRlcnIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHN0ZGVyciA9IGRhdGE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc3RkZXJyICs9IGRhdGE7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBjaGlsZC5vbihcImVycm9yXCIsIHJlamVjdCk7XG4gICAgICBjaGlsZC5vbihcImNsb3NlXCIsIChjb2RlOiBudW1iZXIpID0+IHtcbiAgICAgICAgaWYgKGNvZGUgPT09IDApIHtcbiAgICAgICAgICByZXNvbHZlKHN0ZG91dCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IGVsc2UgaWYgKHN0ZGVycikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3Ioc3RkZXJyKTtcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKHN0ZGVycikpO1xuICAgICAgICB9IGVsc2UgaWYgKHN0ZG91dCkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3Ioc3Rkb3V0KTtcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKHN0ZG91dCkpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxufVxuIl0sCiAgIm1hcHBpbmdzIjogIjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBVUEsUUFBSSxrQkFBa0I7QUFHdEIsUUFBSSxNQUFNLElBQUk7QUFHZCxRQUFJLFlBQVk7QUFHaEIsUUFBSSxTQUFTO0FBR2IsUUFBSSxhQUFhO0FBR2pCLFFBQUksYUFBYTtBQUdqQixRQUFJLFlBQVk7QUFHaEIsUUFBSSxlQUFlO0FBR25CLFFBQUksYUFBYSxPQUFPLFVBQVUsWUFBWSxVQUFVLE9BQU8sV0FBVyxVQUFVO0FBR3BGLFFBQUksV0FBVyxPQUFPLFFBQVEsWUFBWSxRQUFRLEtBQUssV0FBVyxVQUFVO0FBRzVFLFFBQUksT0FBTyxjQUFjLFlBQVksU0FBUyxhQUFhLEVBQUU7QUFHN0QsUUFBSSxjQUFjLE9BQU87QUFPekIs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
